# 护眼小助手架构设计

## 架构概述

护眼小助手是一个基于 Electron 框架的桌面应用，采用了经典的主进程/渲染进程分离架构。主进程负责核心业务逻辑（计时器、浏览器控制），而渲染进程负责用户界面展示。

## 核心模块

### 1. 主进程核心模块

- **Timer 模块**：实现计时器的核心功能，包括工作/休息时间管理、状态转换等。
- **Browser Control 模块**：负责与浏览器进行通信，监测浏览器中的视频播放状态。
- **Window Management 模块**：管理主窗口和全屏提醒窗口的创建、切换和通信。

### 2. 渲染进程核心模块

- **主计时器界面**：展示当前计时状态和控制选项。
- **设置面板**：管理用户配置选项。
- **全屏休息提醒**：在休息时间到来时显示全屏提醒。

### 3. IPC 通信机制

主进程和渲染进程通过 Electron 的 IPC 机制进行通信。主要通信事件包括：

- **timer-update**：向渲染进程发送计时器更新信息
- **rest-start**：通知休息时间开始
- **rest-end**：通知休息时间结束
- **browser-control-status**：传输浏览器控制状态

## 数据流

1. **计时器数据流**：
   - 用户设置工作/休息时间 → 渲染进程传递到主进程 → Timer 模块处理 → 定时更新通知渲染进程 → UI 展示当前状态

2. **浏览器监控数据流**：
   - BrowserControl 模块连接浏览器 → 监测视频播放状态 → 通知Timer模块 → 通知渲染进程更新界面

## 技术细节

### 1. Chrome DevTools Protocol 集成

将Chrome DevTools Protocol (CDP)集成到应用中，实现了与浏览器的自动通信。这使得应用能够实时监测浏览器中的视频播放状态。

### 2. 多窗口协调

应用中的主窗口和全屏提醒窗口是两个独立的渲染进程，通过主进程进行协调和通信。这样的设计允许在休息期间显示全屏提醒，不会干扰用户的其他操作。

### 3. 高效计时器实现

计时器实现采用了基于实际时间的柔性更新策略，而非简单的定时器函数。这样的实现可以更准确地跟踪时间，对系统掩码或窗口切换等情况有更好的适应性。

### 4. 多主题支持

应用采用 CSS 变量和动态类名切换来实现多主题支持。这种方式相比于通过动态加载不同的 CSS 文件，有更好的性能和灵活性。

## 功能扩展设计

本应用设计了清晰的模块边界，便于进行功能扩展：

1. **新增用户通知方式**：可以扩展Timer模块，添加桌面通知、自定义声音等多种提醒方式。

2. **用户数据同步**：可以集成云端存储，实现用户设置和统计数据的多设备同步。

3. **监测扩展**：可以扫展 BrowserControl 模块，添加对多种应用的监控支持。

## 性能考量

1. **低内存占用**：将计时逻辑放在主进程中，集中处理复杂计算，减少渲染进程负担。

2. **渲染优化**：使用 React.memo 和有选择性的重渲染策略，尽量减少不必要的 UI 更新。

3. **浏览器控制开销**：浏览器控制模块采用间隔检测策略，尽量减少 CDP 通信频率，降低资源占用。